var searchData,searchField,originalSearchData,ageSlider,dateSlider,searchSwaps=[];function uniqueArray(e){return e=e.filter(function(e,t,a){return""!==e&&a.indexOf(e)===t})}function populateSearchFromUrl(){let e=new URLSearchParams(window.location.search);e.has("query")&&$("#searchField").val(e.get("query")).keyup(),e.has("relatedThemes")&&($("#relatedThemesFilter").addClass("show"),$("#"+e.get("relatedThemes")).click())}function parseNumbers(e,t,a,r){a=a||!1,t=t||!1;"birth"==(e=String(e)).toLowerCase()&&(e="0");var l=e.match(/\d+/g);if(!l)return null;for(i=0;i<l.length;i++)l[i]=Number(l[i]),isNaN(l[i]),t&&l[i]<100&&(l[i]=2e3+Number(l[i]));return r&&(l=l.filter(function(e){return e<1960||e>2030})),a?Math.max.apply(null,l):l.sort(function(e,t){return e-t})}function rangeOverlaps(e,t,a){return null==e||null==t||((a=a||!1)||(e.sort(function(e,t){return e-t}),t.sort(function(e,t){return e-t})),e[0]>t[0]?(r=e,i=t):(r=t,i=e),Number(r[0])<=Number(i[i.length-1]));var r,i}function arraymove(e,t,a){var r=e[t];e.splice(t,1),e.splice(a,0,r)}function createFilters(){var e=[],t=[],a=[],r=[],i=[],l=[],s=[],o=[];$.each(searchData,function(n,c){c["Related Themes"]&&(e=e.concat(c["Related Themes"].split(","))),c["Study design"]&&(t=t.concat(c["Study design"].split(","))),c["Sample characteristics"]&&(a=a.concat(c["Sample characteristics"].split(","))),c["Geographic coverage"]&&(r=r.concat(c["Geographic coverage"].split(","))),c["Complementary data"]&&(i=i.concat(c["Complementary data"].split(",")));let d=parseNumbers(String(c["Start date"]),!0);null!==d&&(l=l.concat(d));let p=parseNumbers(String(c["Age at recruitment"]),!1,!1,!0);null!==p&&(s=s.concat(p));let h=parseNumbers(String(c["Sample size at recruitment"]).replaceAll(",",""),!1,!0);null!==h&&(o=o.concat(h))});for(var n=1;n<e.length;n++)e[n]=e[n].trim(),e[n]=e[n].charAt(0).toUpperCase()+e[n].substr(1);for(n=1;n<t.length;n++)t[n]=t[n].trim(),t[n]=t[n].charAt(0).toUpperCase()+t[n].substr(1);for(n=1;n<a.length;n++)a[n]=a[n].trim(),a[n]=a[n].charAt(0).toUpperCase()+a[n].substr(1);for(n=1;n<r.length;n++)r[n]=r[n].trim(),r[n]=r[n].charAt(0).toUpperCase()+r[n].substr(1);for(n=1;n<i.length;n++)i[n]=i[n].trim(),i[n]=i[n].charAt(0).toUpperCase()+i[n].substr(1);e=uniqueArray(e).sort(),t=uniqueArray(t).sort(),a=uniqueArray(a).sort(),(r=uniqueArray(r).sort()).push(r.splice(r.indexOf("Local"),1)[0]),r.push(r.splice(r.indexOf("National"),1)[0]),arraymove(t,0,2),arraymove(t,1,0),arraymove(t,4,2),arraymove(t,5,6),i=uniqueArray(i).sort(),$.each(e,function(e,t){let a="RM"+t.replaceAll(" ","_");var r="<div class='custom-control custom-switch'><input type='checkbox' class='relatedThemesFilter toggleFilter form-control custom-control-input' id='"+a+"' value='"+t+"' name='"+t+"'><label class='custom-control-label' for='"+a+"'>"+t+"</label></div>";$("#relatedThemesFilter .card-body").append($(r))}),$.each(t,function(e,t){let a="SD"+t.replaceAll(" ","_");var r="<div class='custom-control custom-switch'><input type='checkbox' class='studyDesignFilter toggleFilter form-control custom-control-input' id='"+a+"' value='"+t+"' name='"+t+"'><label class='custom-control-label' for='"+a+"'>"+t+"</label></div>";$("#studyDesignFilter .card-body").append($(r))}),$.each(a,function(e,t){let a="SC"+t.replaceAll(" ","_");var r="<div class='custom-control custom-switch'><input type='checkbox' class='sampleCharacteristicsFilter toggleFilter form-control custom-control-input' id='"+a+"' value='"+t+"' name='"+t+"'><label class='custom-control-label' for='"+a+"'>"+t+"</label></div>";$("#sampleCharacteristicsFilter .card-body").append($(r))}),$.each(r,function(e,t){let a="GC"+t.replaceAll(" ","_");var r="<div class='custom-control custom-switch'><input type='checkbox' class='geographicCoverageFilter toggleFilter form-control custom-control-input' id='"+a+"' value='"+t+"' name='"+t+"'><label class='custom-control-label' for='"+a+"'>"+t+"</label></div>";$("#geographicCoverageFilter .card-body").append($(r))}),$.each(i,function(e,t){let a="CD"+t.replaceAll(" ","_");var r="<div class='custom-control custom-switch'><input type='checkbox' class='complementaryDataFilter toggleFilter form-control custom-control-input' id='"+a+"' value='"+t+"' name='"+t+"'><label class='custom-control-label' for='"+a+"'>"+t+"</label></div>";$("#complementaryDataFilter .card-body").append($(r))}),$("#Local").parent(".custom-switch").addClass("mt-2"),$("#Household_panel_study").parent(".custom-switch").addClass("mt-2"),$("#Twin_study").parent(".custom-switch").addClass("mt-2"),l=uniqueArray(l).sort(function(e,t){return e-t}),s=uniqueArray(s).sort(function(e,t){return e-t}),o=uniqueArray(o).sort(function(e,t){return e-t}),$("#ageSlider").before("<div><b style='float:left;'>"+(0==s[0]?"Birth":s[0])+"</b><b style='float:right;'>"+s[s.length-1]+"</b></div>"),ageSlider=$("#ageSlider").slider({min:Number(s[0]),max:Number(s[s.length-1]),value:[Number(s[0]),Number(s[s.length-1])],tooltip:"always",formatter:function(e){var t=String(e).split(",");return(0==t[0]?"Birth":t[0])+" - "+t[1]}}),$("#dateSlider").before("<div><b style='float:left;'>"+l[0]+"</b><b style='float:right;'>"+l[l.length-1]+"</b></div>"),dateSlider=$("#dateSlider").slider({min:Number(l[0]),max:Number(l[l.length-1]),value:[Number(l[0]),Number(l[l.length-1])],tooltip:"always",formatter:function(e){var t=String(e).split(",");return t[0]+" - "+t[1]}}),$("#sizeSlider").before("<div><b style='float:left;'>"+numberWithCommas(o[0])+"</b><b style='float:right;'>"+numberWithCommas(o[o.length-1])+"</b></div>"),sizeSlider=$("#sizeSlider").slider({min:o[0],max:Number(o[o.length-1]),value:[1,Number(o[o.length-1])],scale:"logarithmic",tooltip:"always",formatter:function(e){if(e){var t=String(e).split(",");return numberWithCommas(t[0])+" - "+numberWithCommas(t[1])}}})}function clearFilters(){localStorage.removeItem("relatedThemesState"),localStorage.removeItem("studyDesignState"),localStorage.removeItem("sampleCharacteristicsState"),localStorage.removeItem("geographicCoverageState"),localStorage.removeItem("complementaryDataState"),$('#dateSlider, #ageSlider, .toggleFilter:not(".andOr")').off("change"),dateSlider.slider("setValue",new Array(Number($("#dateRangeFilter .slider-handle").attr("aria-valuemin")),Number($("#dateRangeFilter .slider-handle").attr("aria-valuemax")))),ageSlider.slider("setValue",new Array(Number($("#ageRangeFilter .slider-handle").attr("aria-valuemin")),Number($("#ageRangeFilter .slider-handle").attr("aria-valuemax")))),sizeSlider.slider("setValue",new Array(Number($("#sizeRangeFilter .slider-handle").attr("aria-valuemin")),Number($("#sizeRangeFilter .slider-handle").attr("aria-valuemax")))),$('.toggleFilter:not(".andOr"):checked').each(function(){$(this).prop("checked",!1)}),$('#dateSlider, #ageSlider, #sizeSlider, .toggleFilter:not(".andOr")').change(function(){updateFilters()}),updateFilters()}function updateFilters(e){if(!(e=e||!1)&&0==$("#filtersToggle").prop("checked")&&$("#filtersToggle").is(":visible"))return updateSearchResults(originalSearchData),!0;var t=originalSearchData,a=parseNumbers($("#dateSlider").val()),r=parseNumbers($("#ageSlider").val()),l=parseNumbers($("#sizeSlider").val()),s=[],o=[],n=[],c=[],d=[];if($(".relatedThemesFilter:checked").length&&$(".relatedThemesFilter:checked").each(function(){s.push(this.name)}),$(".studyDesignFilter:checked").length&&$(".studyDesignFilter:checked").each(function(){o.push(this.name)}),$(".sampleCharacteristicsFilter:checked").length&&$(".sampleCharacteristicsFilter:checked").each(function(){n.push(this.name)}),$(".geographicCoverageFilter:checked").length&&$(".geographicCoverageFilter:checked").each(function(){c.push(this.name)}),$(".complementaryDataFilter:checked").length&&$(".complementaryDataFilter:checked").each(function(){d.push(this.name)}),e){var p=localStorage.getItem("dateSliderState"),h=localStorage.getItem("ageSliderState"),u=localStorage.getItem("sizeSliderState"),g=localStorage.getItem("relatedThemesState"),m=localStorage.getItem("studyDesignState"),S=localStorage.getItem("sampleCharacteristicsState"),f=localStorage.getItem("geographicCoverageState"),y=localStorage.getItem("complementaryDataState");try{if(p&&($("#dateRangeFilter").collapse("show"),a=p.split(","),dateSlider.slider("setValue",parseNumbers(p))),u&&($("#sizeRangeFilter").collapse("show"),l=u.split(","),sizeSlider.slider("setValue",parseNumbers(u))),h&&($("#ageRangeFilter").collapse("show"),r=h.split(","),ageSlider.slider("setValue",parseNumbers(h))),g)for($("#relatedThemesFilter").collapse("show"),s=g.split(","),$("#relatedAndOr").prop("checked","true"==s[0]),s.shift(),i=0;i<s.length;i++)$(".relatedThemesFilter[name='"+s[i]+"']").prop("checked",!0);if(m)for($("#studyDesignFilter").collapse("show"),o=m.split(","),$("#sdAndOr").prop("checked","true"==o[0]),o.shift(),i=0;i<o.length;i++)$(".studyDesignFilter[name='"+o[i]+"']").prop("checked",!0);if(S)for($("#sampleCharacteristicsFilter").collapse("show"),n=S.split(","),$("#scAndOr").prop("checked","true"==n[0]),n.shift(),i=0;i<n.length;i++)$(".sampleCharacteristicsFilter[name='"+n[i]+"']").prop("checked",!0);if(f)for($("#geographicCoverageFilter").collapse("show"),c=f.split(","),$("#gcAndOr").prop("checked","true"==c[0]),c.shift(),i=0;i<c.length;i++)$(".geographicCoverageFilter[name='"+c[i]+"']").prop("checked",!0);if(y)for($("#complementaryDataFilter").collapse("show"),d=y.split(","),$("#cdAndOr").prop("checked","true"==d[0]),d.shift(),i=0;i<d.length;i++)$(".complementaryDataFilter[name='"+d[i]+"']").prop("checked",!0);$("#dateSlider, #ageSlider, #sizeSlider, .toggleFilter").off("change").change(function(){updateFilters()})}catch(e){clearFilters()}}var v=!1;s.length?(v=!0,t=filterItems(t,function(e){var t;return t=$("#relatedAndOr").prop("checked")?"^(?=[\\s\\S]*("+(t=s.join("))(?=[\\s\\S]*(")+"))").replace(/["]/g,""):(t=s.join("|")).replace(/["]/g,""),(t=new RegExp(t,"i")).test(e["Related Themes"])}),localStorage.setItem("relatedThemesState",[$("#relatedAndOr").prop("checked")].concat(Array(s.join(","))))):localStorage.removeItem("relatedThemesState"),o.length?(v=!0,t=filterItems(t,function(e){var t;return t=$("#sdAndOr").prop("checked")?"^(?=[\\s\\S]*("+(t=o.join("))(?=[\\s\\S]*(")+"))").replace(/["]/g,""):(t=o.join("|")).replace(/["]/g,""),(t=new RegExp(t,"i")).test(e["Study design"])}),localStorage.setItem("studyDesignState",[$("#sdAndOr").prop("checked")].concat(Array(o.join(","))))):localStorage.removeItem("studyDesignState"),n.length?(v=!0,t=filterItems(t,function(e){var t;return t=$("#scAndOr").prop("checked")?"^(?=[\\s\\S]*("+(t=n.join("))(?=[\\s\\S]*(")+"))").replace(/["]/g,""):(t=n.join("|")).replace(/["]/g,""),(t=new RegExp(t,"i")).test(e["Sample characteristics"])}),localStorage.setItem("sampleCharacteristicsState",[$("#scAndOr").prop("checked")].concat(Array(n.join(","))))):localStorage.removeItem("sampleCharacteristicsState"),c.length?(v=!0,t=filterItems(t,function(e){var t;return t=$("#gcAndOr").prop("checked")?"^(?=[\\s\\S]*("+(t=c.join("))(?=[\\s\\S]*(")+"))").replace(/["]/g,""):(t=c.join("|")).replace(/["]/g,""),(t=new RegExp(t,"i")).test(e["Geographic coverage"])}),localStorage.setItem("geographicCoverageState",[$("#gcAndOr").prop("checked")].concat(Array(c.join(","))))):localStorage.removeItem("geographicCoverageState"),d.length?(v=!0,t=filterItems(t,function(e){var t;return t=$("#cdAndOr").prop("checked")?"^(?=[\\s\\S]*("+(t=d.join("))(?=[\\s\\S]*(")+"))").replace(/["]/g,""):(t=d.join("|")).replace(/["]/g,""),(t=new RegExp(t,"i")).test(e["Complementary data"])}),localStorage.setItem("complementaryDataState",[$("#cdAndOr").prop("checked")].concat(Array(d.join(","))))):localStorage.removeItem("complementaryDataState"),$("#dateRangeFilter .slider-handle").attr("aria-valuemin")==a[0]&&$("#dateRangeFilter .slider-handle").attr("aria-valuemax")==a[1]?(a=!1,localStorage.removeItem("dateSliderState")):(v=!0,t=filterItems(t,function(e){return rangeOverlaps(parseNumbers(e["Start date"],!0),a)}),localStorage.setItem("dateSliderState",a.join(","))),$("#ageRangeFilter .slider-handle").attr("aria-valuemin")==r[0]&&$("#ageRangeFilter .slider-handle").attr("aria-valuemax")==r[1]?(r=!1,localStorage.removeItem("ageSliderState")):(v=!0,t=filterItems(t,function(e){return rangeOverlaps(parseNumbers(e["Age at recruitment"],!1,!1,!0),r)}),localStorage.setItem("ageSliderState",r.join(","))),$("#sizeRangeFilter .slider-handle").attr("aria-valuemin")==l[0]&&$("#sizeRangeFilter .slider-handle").attr("aria-valuemax")==l[1]?(l=!1,localStorage.removeItem("sizeSliderState")):(v=!0,t=filterItems(t,function(e){return rangeOverlaps([parseNumbers(String(e["Sample size at recruitment"]).replaceAll(",",""),!1,!0)],l)}),localStorage.setItem("sizeSliderState",l.join(","))),v?($("#filtersToggleSpan").show(),$("#filtersToggle").prop("checked",!0)):($("#filtersToggleSpan").hide(),$("#filtersToggle").prop("checked",!1)),updateSearchResults(t)}function updateSearchResults(e,t){t=t||!1;var a=!1,r=[];if((e=e||!1)&&Object.keys(e).toString()!=Object.keys(searchData).toString())searchData=e;else if(searchField==$("#searchField").val())return!1;r=(searchField=cleanSearchField($("#searchField").val(),t))[1],searchField=searchField[0];var i="";if(searchField.length>2){searchField=(searchField=searchField.replace(/ OR /gi," OR ")).replace(/(\w+-\w+)/gi,'"$&"');var l=stringSearch.simplify(stringSearch.parse(searchField)),s=["AND","OR","AU","AS"];buildSearchRegex=function(e){var t=[],a=e[0];if("And"==a||"Or"==a){for(var r in e[1])t=t.concat(buildSearchRegex(e[1][r]));return t=["("+t.join("And"==a?"":"|")+")"]}return("Text"==a||"Exactly"==a)&&e[1].length>2&&-1==s.indexOf(String(e[1]).toUpperCase)?"(?=([\\S\\s]*"+e[1]+"))":"Pair"==a&&e[2].length>2&&-1==s.indexOf(String(e[2]).toUpperCase)?"(?=([\\S\\s]*"+e[1]+"[^{]*:{[^}]*"+e[2]+"))":(Array.isArray(e[1])&&(t=t.concat(buildSearchRegex(e[1]))),"Including"==a||"Group"==a?["("+t.join("")+")"]:"Excluding"==a?["(?!("+t.join("")+"))"]:t)},buildHighlightRegex=function(e){var t=[],a=e[0];if("And"==a||"Or"==a){for(var r in e[1])t=t.concat(buildHighlightRegex(e[1][r]));return t}return("Text"==a||"Exactly"==a)&&e[1].length>2&&-1==s.indexOf(String(e[1]).toUpperCase())&&t.push("("+e[1]+")"),"Pair"==a&&e[2].length>2&&-1==s.indexOf(String(e[2]).toUpperCase())&&t.push(e[1]+"[^<>]*<\\/b><br>[^<>]*("+e[2]+")"),"Excluding"!=a&&Array.isArray(e[1])&&(t=t.concat(buildHighlightRegex(e[1]))),t};var o="^"+buildSearchRegex(l).join("");o=new RegExp(o,"i");""==(n=(n=buildHighlightRegex(l).join("|")).replace(/["]/g,"")).trim()&&(a=!0);var n=new RegExp(n,"ig");i="";Object.keys(searchData).sort().forEach(function(e,t){let r=searchData[e];var l="";for(var s in r)l+=s+":{"+r[s]+"} ";var c=[];if(o.test(l))if(a)i+='<div class="card shadow mb-4 searchResult" sid="'+e+'"><div class="card-header py-3"><h6 class="m-0 font-weight-bold text-primary d-flex align-items-center flex-wrap">',i+='<img class="funderImage" src="img/studies/'+e+'.png" alt="" onerror=\'this.style.display="none"\'/>'+r.Title+"</h6>",i+='</div><div class="card-body">',i+="<p>"+r.Aims+"</p>",i+="</div></div>";else{for(var s in r){for(var d,p=[];d=n.exec("<p><b>"+s+"</b><br>"+r[s]);)p.push(getFirstGroupMatch(d));p.length&&(p=uniqueArray(p),c[s]=p)}for(var s in i+='<div class="card shadow mb-4 searchResult" sid="'+e+'"><div class="card-header py-3"><h6 class="m-0 font-weight-bold text-primary d-flex align-items-center flex-wrap">',i+='<img class="funderImage" src="img/studies/'+e+'.png" alt="" onerror=\'this.style.display="none"\'/>'+r.Title+"</h6>",i+='</div><div class="card-body">',c){for(var h in matchString="<p><b>"+s+"</b><br>"+r[s],c[s]){var u=new RegExp(c[s][h],"ig");matchString=matchString.replace(u,'<span class="highlighted">$&</span>')}matchString=matchString.replace(/[\\|.][^<>]+$/," ..."),matchString=matchString.replace(/^[^<>]+[\\|.]/,"... "),matchString=matchString.replace(/[\\|.][^<>]+[\\|.]/g," ... "),i+=matchString+"</p>"}i+="</div></div>"}})}else Object.keys(searchData).sort().forEach(function(e,t){let a=searchData[e];i+='<div class="card shadow mb-4 searchResult" sid="'+e+'"><div class="card-header py-3"><h6 class="m-0 font-weight-bold text-primary d-flex align-items-center flex-wrap">',i+='<img class="funderImage" src="img/studies/'+e+'.png" alt="" onerror=\'this.style.display="none"\'/>'+a.Title+"</h6>",i+='</div><div class="card-body">',i+="<p>"+a.Aims+"</p>",i+='</div><a href="?content=study&studyid='+e+'"></a></div>'});""==i&&(i="<p>No results, please try a different search term or remove some filters.</p>"),$("#studyList").html()!=i&&$("#studyList").html(i);var c="";!t&&r.length&&(c+="Adding the alternative terms: <i>"+r.join(", ")+"</i> based on your search terms <a href='#' onclick='updateSearchResults(false, true);' >UNDO</a><br>"),c+="Studies found: "+$("#studyList .card").length,$("#searchSummary").html(c),$(".searchResult").click(function(){const e=$(this).attr("sid");"function"==typeof gtag?(setTimeout(function(){window.location="?content=study&studyid="+e},200),gtag("event",e,{event_label:"Query: "+$("#searchField").val()+" RelThemes: "+localStorage.getItem("relatedThemesState")+" Date: "+localStorage.getItem("dateSliderState")+" Age: "+localStorage.getItem("ageSliderState")+" Size: "+localStorage.getItem("sizeSliderState"),event_category:"SearchEnd",transport_type:"beacon",event_callback:function(){window.location="?content=study&studyid="+e}})):window.location="?content=study&studyid="+e})}function getFirstGroupMatch(e){var t=-99;for(var a in e)isNumeric(a)&&Number(a)>t&&void 0!==e[a]&&(t=a);return e[t]}function cleanSearchField(e,t){t=t||!1;e=e.replace(/[|<>{[}&]]/g," ");var a=[];if(!t)for(var r in searchSwaps){var i="(^|\\s|\\()"+searchSwaps[r].join("(\\s|$|\\))|(^|\\s|\\()")+"($|\\s|\\))";(i=new RegExp(i,"ig")).test(e)&&(e="("+e+') OR "'+r+'"',a.push(r))}return new Array(e,a)}function isNumeric(e){return!isNaN(parseFloat(e))&&isFinite(e)}function capitalizeFirstLetter(e){return e.charAt(0).toUpperCase()+e.slice(1)}function filterItems(e,t){var a,r={};for(a in e)e.hasOwnProperty(a)&&t(e[a])&&(r[a]=e[a]);return r}function numberWithCommas(e){if(e)return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}searchSwaps.ADHD=["Hyperactivity","Inattention","Impulsivity","ADD","Hyperkinesis","Learning difficulty","Learning disorder","Neurodevelopmental disorder"],searchSwaps.Hyperactivity=["Inattention","ADHD","Impulsivity","ADD","Hyperkinesis","Learning difficulty","Learning disorder","Neurodevelopmental disorder"],searchSwaps.Inattention=["Hyperactivity","ADHD","Impulsivity","ADD","Hyperkinesis","Learning difficulty","Learning disorder","Neurodevelopmental disorder"],searchSwaps.Autism=["Asperger[’']?s","Neurodevelopmental disorder"],searchSwaps.Anxiety=["Emotional problems","Phobia","Agoraphobia","Panic","GAD","Social anxiety","Fear"],searchSwaps["Emotional problems"]=["Anxiety","Phobia","Agoraphobia","Panic","GAD","Social anxiety","Fear"],searchSwaps["Behavioural problems"]=["Externalising","Externalizing","Conduct disorder","Conduct problems","ODD","Oppositional defiant disorder","Oppositionality","ASPD","CD","Delinquency"],searchSwaps["Psychological Distress"]=["Depression","Anxiety","Stress","Dysthymia","MDD","Major depression","Emotional problems","Depressive episode","Mood disorder"],searchSwaps["Borderline personality disorder"]=["Borderline","Emotionally unstable personality disorder","EUPD","BPD"],searchSwaps.Borderline=["Borderline personality disorder","Emotionally unstable personality disorder","EUPD","BPD"],searchSwaps["Bipolar disorder"]=["Mania","Manic depression","Bipolar affective disorder","BPAD","Mood disorder"],searchSwaps.Mania=["Bipolar disorder","Manic depression","Bipolar affective disorder","BPAD","Mood disorder"],searchSwaps["Emotional Problems"]=["Internalising","Internalizing","Depression","Anxiety"],searchSwaps.Psychopathy=["Callous-unemotional traits","Sociopathy"],searchSwaps["Callous-unemotional traits"]=["Psychopathy","Sociopathy"],searchSwaps.Depression=["Dysthymia","MDD","Major depression","Emotional problems","Depressive episode","Mood disorder"],searchSwaps["Eating disorders"]=["Anorexia","Bulimia","Binge eating","Feeding"],searchSwaps["Antisocial personality disorder"]=["Antisocial behaviour","Conduct disorder","Conduct problems","ODD","Oppositional defiant disorder","Oppositionality","ASPD","CD","Delinquency"],searchSwaps["Antisocial behaviour"]=["Antisocial personality disorder","Conduct disorder","Conduct problems","ODD","Oppositional defiant disorder","Oppositionality","ASPD","CD","Delinquency"],searchSwaps["Alcohol use"]=["Alcoholism","alcoholic","Addiction","AUD","Alcohol dependence","Alcohol abuse","Alcohol misuse","Alcohol problem","Fetal alcohol spectrum disorder","Fetal alcohol syndrome","FASD"],searchSwaps["Substance use"]=["Drug use","Drug abuse","Drug misuse","Drug problem","Substance abuse","Substance misuse","Substance dependence","Substance use disorder","Addiction","Illicit","SUD","Cannabis"],searchSwaps.Smoking=["Addiction","Cigarette","Pack year","Tobacco dependence"],searchSwaps["Tobacco use"]=["Addiction","Cigarette","Pack year","Tobacco dependence"],searchSwaps.Gambling=["Pathological gambling","Addiction","Gaming"],searchSwaps.PTSD=["Trauma","Stress"],searchSwaps["Post-traumatic stress disorder"]=["Trauma","Stress"],searchSwaps.Schizophrenia=["Hallucination","Psychosis","Schizotypal personality disorder","Delusion","Voices","Psychotic","Schizophreniform disorder"],searchSwaps.Psychosis=["Schizophrenia","Hallucination","Schizotypal personality disorder","Delusion","Voices","Psychotic","Schizophreniform disorder"],searchSwaps["Schizotypal personality disorder"]=["Schizophrenia","Psychosis","Hallucination","Delusion","Voices","Psychotic","Schizophreniform disorder"],searchSwaps["Self harm"]=["Suicide","Suicidality","Non-suicidal self-injury","NSSI","Self-injury","Self-mutilation","Cutting","Suicidal ideation"],searchSwaps.Suicidality=["Self harm","Suicide","Non-suicidal self-injury","NSSI","Self-injury","Self-mutilation","Cutting","Suicidal ideation"],searchSwaps.Suicide=["Self harm","Suicidality","Non-suicidal self-injury","NSSI","Self-injury","Self-mutilation","Cutting","Suicidal ideation"],searchSwaps.Impairment=["Disability","Impact"],searchSwaps["Psychological wellbeing"]=["Well being","Wellness","Well-being","Happiness","Life satisfaction"],searchSwaps["Treatment and service use"]=["Patient","Hospital","Psychiatry","Sectioned","Help seeking"],searchSwaps["Treatment - medication"]=["Antidepressant","Antipsychotic","Pharmacology","Prescription","Medicine"],searchSwaps["Treatment - in-patient"]=["Hospital","Involuntary","Section","sectioned","MHA","Mental Health Act"],searchSwaps["Treatment - specialist"]=["Psychotherapy","Psychology","Psychiatry","Talking therapy","Counselling","Counsellor"],searchSwaps["Treatment and service use - school support"]=["SEN","IEP","Teacher[’']?s aid","Special school","Special needs school"],$.getJSON("api/getSearchData.php",function(e){searchData=e,originalSearchData=e,$(document).ready(function(){createFilters(),$("#Covid-19_data_collection_during_pandemic").parent().addClass("mb-2").addClass("font-weight-bold").insertAfter($("#relatedAndOr").parent()),$('[data-toggle="tooltip"]').tooltip({container:"body",boundary:"window",offset:0,customClass:"searchInfobuttonTooltip"}),updateFilters(!0),populateSearchFromUrl()})}),String.prototype.replaceAll||(String.prototype.replaceAll=function(e,t){return"[object regexp]"===Object.prototype.toString.call(e).toLowerCase()?this.replace(e,t):this.replace(new RegExp(e,"g"),t)}),$("#searchField").keyup(function(){updateSearchResults()});
!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).stringSearch=t()}}(function(){return function(){return function t(s,i,e){function f(h,r){if(!i[h]){if(!s[h]){var n="function"==typeof require&&require;if(!r&&n)return n(h,!0);if(_)return _(h,!0);var o=new Error("Cannot find module '"+h+"'");throw o.code="MODULE_NOT_FOUND",o}var u=i[h]={exports:{}};s[h][0].call(u.exports,function(t){return f(s[h][1][t]||t)},u,u.exports,t,s,i,e)}return i[h].exports}for(var _="function"==typeof require&&require,h=0;h<e.length;h++)f(e[h]);return f}}()({1:[function(t,s,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.stringToTree=h,i.reduce=r,i.parse=function(t){if("string"!=typeof t)throw new Error("Query must be a string");return r(h(t))},i.stringify=function(t){return f.default.Value.stringify(t)},i.simplify=function(t){var s=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];return f.default.Value.simplify(t,s)};var e=_(t("../grammar/query")),f=_(t("./types"));function _(t){return t&&t.__esModule?t:{default:t}}function h(t){if("string"!=typeof t)throw new Error("Query must be a string");return e.default.parse(t,{types:f.default})}function r(t){if(!t||"function"!=typeof t.reduce)throw new Error("Tree must be a parsed AST");return t.reduce()}},{"../grammar/query":3,"./types":2}],2:[function(t,s,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var e=function(){return function(t,s){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,s){var i=[],e=!0,f=!1,_=void 0;try{for(var h,r=t[Symbol.iterator]();!(e=(h=r.next()).done)&&(i.push(h.value),!s||i.length!==s);e=!0);}catch(t){f=!0,_=t}finally{try{!e&&r.return&&r.return()}finally{if(f)throw _}}return i}(t,s);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();var f={Value:{reduce:function(){return this.value.reduce()},stringify:function(t){var s=e(t,1)[0];return f[s].stringify(t)},simplify:function(t,s){var i,_=s.disallow,h=void 0===_?[]:_,r=e(t,1)[0];return i=r,h.some(function(t){return i===t})?["Text",f.Value.stringify(t)]:"function"==typeof f[r].simplify?[r,f[r].simplify(t,s)]:t}},Text:{reduce:function(){return["Text",this.text]},stringify:function(t){return e(t,2)[1]}},Values:{reduce:function(){return this.elements.map(function(t){return f.Value.reduce.call(t)})},stringify:function(t){return t.map(function(t){return f.Value.stringify(t)}).join(" ")},simplify:function(t,s){return t.map(function(t){return f.Value.simplify(t,s)})}},Pair:{reduce:function(){return["Pair",this.k.text.toLowerCase(),this.v.text]},stringify:function(t){var s=e(t,3);return s[1]+":"+s[2]}},Group:{reduce:function(){return["Group",this.root.reduce()]},stringify:function(t){var s=e(t,2)[1];return"("+f.Value.stringify(s)+")"}},And:{reduce:function(){return["And",f.Values.reduce.call(this)]},stringify:function(t){var s=e(t,2)[1];return f.Values.stringify(s)},simplify:function(t,s){var i=e(t,2)[1];return f.Values.simplify(i,s)}},Or:{reduce:function(){return["Or",[this.value.reduce()].concat(this.or_groups.reduce())]},stringify:function(t){return e(t,2)[1].map(function(t){return f.Value.stringify(t)}).join(" OR ")},simplify:function(t,s){var i=e(t,2)[1];return f.Values.simplify(i,s)}},Exactly:{reduce:function(){return["Exactly",this.value.text]},stringify:function(t){return'"'+e(t,2)[1]+'"'}},Including:{reduce:function(){return["Including",this.value.reduce()]},stringify:function(t){var s=e(t,2)[1];return f.Value.stringify(s)},simplify:function(t,s){var i=e(t,2)[1];return f.Value.simplify(i,s)}},Excluding:{reduce:function(){return["Excluding",this.value.reduce()]},stringify:function(t){var s=e(t,2)[1];return"-"+f.Value.stringify(s)},simplify:function(t,s){var i=e(t,2)[1];return f.Value.simplify(i,s)}},List:{reduce:function(){return["List",this.list_name.screen_name.text,this.list_name.list_slug.text]},stringify:function(t){var s=e(t,3);return"list:"+s[1]+"/"+s[2]}}};i.default=f},{}],3:[function(t,s,i){!function(){"use strict";var s=function(t,s){if(!t||!s)return t;for(var i in s)t[i]!==s[i]&&(t[i]=s[i]);return t},e=function(t,s){var i=function(){};i.prototype=s.prototype,t.prototype=new i,t.prototype.constructor=t},f=function(t,s,i){this.text=t,this.offset=s,this.elements=i||[]};f.prototype.forEach=function(t,s){for(var i=this.elements,e=0,f=i.length;e<f;e++)t.call(s,i[e],e,i)};var _=function(t,s,i){f.apply(this,arguments),this.value=i[1],this.query=i[1]};e(_,f);var h=function(t,s,i){f.apply(this,arguments),this.value=i[0],this.operator=i[0]};e(h,f);var r=function(t,s,i){f.apply(this,arguments),this.value=i[1],this.base=i[1]};e(r,f);var n=function(t,s,i){f.apply(this,arguments),this.value=i[1]};e(n,f);var o=function(t,s,i){f.apply(this,arguments),this.value=i[0],this.orable=i[0],this.or_groups=i[1]};e(o,f);var u=function(t,s,i){f.apply(this,arguments),this.or_sep=i[0],this.value=i[1],this.orable=i[1]};e(u,f);var a=function(t,s,i){f.apply(this,arguments),this.value=i[1],this.base=i[1]};e(a,f);var l=function(t,s,i){f.apply(this,arguments),this.root=i[1]};e(l,f);var c=function(t,s,i){f.apply(this,arguments),this.k=i[0],this.slug=i[0],this.sep=i[1],this.v=i[2],this.word=i[2]};e(c,f);var p=function(t,s,i){f.apply(this,arguments),this.sep=i[1],this.list_name=i[2]};e(p,f);var d=function(t,s,i){f.apply(this,arguments),this.value=i[1]};e(d,f);var g=function(t,s,i){f.apply(this,arguments),this.tag=i[1]};e(g,f);var v=function(t,s,i){f.apply(this,arguments),this.tag=i[1]};e(v,f);var y=function(t,s,i){f.apply(this,arguments),this.screen_name=i[1]};e(y,f);var b=function(t,s,i){f.apply(this,arguments),this.screen_name=i[0],this.list_slug=i[2]};e(b,f);var w=function(t,s,i){f.apply(this,arguments),this.slug=i[1]};e(w,f);var x=function(t,s,i){f.apply(this,arguments),this.d=i[9]};e(x,f);var m=function(t,s,i){f.apply(this,arguments),this.d=i[0]};e(m,f);var S={},z={_read_root:function(){var t=S,i=this._offset;this._cache._root=this._cache._root||{};var e=this._cache._root[i];if(e)return this._offset=e[1],e[0];for(var h=this._offset,r=new Array(3),n=S,o=0,u=this._offset,a=[],l=!0;l!==S;)(l=this._read___())!==S&&(a.push(l),--o);if(o<=0?(n=new f(this._input.substring(u,this._offset),u,a),this._offset=this._offset):n=S,n!==S){r[0]=n;var c;if((c=this._read_query())!==S){r[1]=c;for(var p=S,d=0,g=this._offset,v=[],y=!0;y!==S;)(y=this._read___())!==S&&(v.push(y),--d);d<=0?(p=new f(this._input.substring(g,this._offset),g,v),this._offset=this._offset):p=S,p!==S?r[2]=p:(r=null,this._offset=h)}else r=null,this._offset=h}else r=null,this._offset=h;return null===r?t=S:(t=new _(this._input.substring(h,this._offset),h,r),this._offset=this._offset),s(t,this._types.Value),this._cache._root[i]=[t,this._offset],t},_read_query:function(){var t=S,i=this._offset;this._cache._query=this._cache._query||{};var e=this._cache._query[i];if(e)return this._offset=e[1],e[0];for(var _=1,r=this._offset,n=[],o=!0;o!==S;){var u,a=this._offset,l=new Array(2);if((u=this._read_operator())!==S){l[0]=u;for(var c=S,p=0,d=this._offset,g=[],v=!0;v!==S;)(v=this._read___())!==S&&(g.push(v),--p);p<=0?(c=new f(this._input.substring(d,this._offset),d,g),this._offset=this._offset):c=S,c!==S?l[1]=c:(l=null,this._offset=a)}else l=null,this._offset=a;null===l?o=S:(o=new h(this._input.substring(a,this._offset),a,l),this._offset=this._offset),o!==S&&(n.push(o),--_)}return _<=0?(t=new f(this._input.substring(r,this._offset),r,n),this._offset=this._offset):t=S,s(t,this._types.And),this._cache._query[i]=[t,this._offset],t},_read_operator:function(){var t=S,s=this._offset;this._cache._operator=this._cache._operator||{};var i=this._cache._operator[s];if(i)return this._offset=i[1],i[0];var e=this._offset;return(t=this._read_excluding())===S&&(this._offset=e,(t=this._read_including())===S&&(this._offset=e)),this._cache._operator[s]=[t,this._offset],t},_read_excluding:function(){var t=S,i=this._offset;this._cache._excluding=this._cache._excluding||{};var e=this._cache._excluding[i];if(e)return this._offset=e[1],e[0];var _=this._offset,h=new Array(2),n=S,o=null;if(this._offset<this._inputSize&&(o=this._input.substring(this._offset,this._offset+1)),"-"===o?(n=new f(this._input.substring(this._offset,this._offset+1),this._offset),this._offset=this._offset+1):(n=S,this._offset>this._failure&&(this._failure=this._offset,this._expected=[]),this._offset===this._failure&&this._expected.push('"-"')),n!==S){h[0]=n;var u;(u=this._read_base())!==S?h[1]=u:(h=null,this._offset=_)}else h=null,this._offset=_;return null===h?t=S:(t=new r(this._input.substring(_,this._offset),_,h),this._offset=this._offset),s(t,this._types.Excluding),this._cache._excluding[i]=[t,this._offset],t},_read_including:function(){var t=S,i=this._offset;this._cache._including=this._cache._including||{};var e=this._cache._including[i];if(e)return this._offset=e[1],e[0];var _=this._offset,h=new Array(2),r=S,o=null;if(this._offset<this._inputSize&&(o=this._input.substring(this._offset,this._offset+0)),""===o?(r=new f(this._input.substring(this._offset,this._offset+0),this._offset),this._offset=this._offset+0):(r=S,this._offset>this._failure&&(this._failure=this._offset,this._expected=[]),this._offset===this._failure&&this._expected.push('""')),r!==S){h[0]=r;var u=S,a=this._offset;(u=this._read_or())===S&&(this._offset=a,(u=this._read_base())===S&&(this._offset=a)),u!==S?h[1]=u:(h=null,this._offset=_)}else h=null,this._offset=_;return null===h?t=S:(t=new n(this._input.substring(_,this._offset),_,h),this._offset=this._offset),s(t,this._types.Including),this._cache._including[i]=[t,this._offset],t},_read_or:function(){var t=S,i=this._offset;this._cache._or=this._cache._or||{};var e=this._cache._or[i];if(e)return this._offset=e[1],e[0];var f,_=this._offset,h=new Array(2);if((f=this._read_orable())!==S){h[0]=f;var r;(r=this._read_or_groups())!==S?h[1]=r:(h=null,this._offset=_)}else h=null,this._offset=_;return null===h?t=S:(t=new o(this._input.substring(_,this._offset),_,h),this._offset=this._offset),s(t,this._types.Or),this._cache._or[i]=[t,this._offset],t},_read_or_groups:function(){var t=S,i=this._offset;this._cache._or_groups=this._cache._or_groups||{};var e=this._cache._or_groups[i];if(e)return this._offset=e[1],e[0];for(var _=1,h=this._offset,r=[],n=!0;n!==S;){var o,a=this._offset,l=new Array(2);if((o=this._read_or_sep())!==S){l[0]=o;var c;(c=this._read_orable())!==S?l[1]=c:(l=null,this._offset=a)}else l=null,this._offset=a;null===l?n=S:(n=new u(this._input.substring(a,this._offset),a,l),this._offset=this._offset),n!==S&&(r.push(n),--_)}return _<=0?(t=new f(this._input.substring(h,this._offset),h,r),this._offset=this._offset):t=S,s(t,this._types.Values),this._cache._or_groups[i]=[t,this._offset],t},_read_orable:function(){var t=S,i=this._offset;this._cache._orable=this._cache._orable||{};var e=this._cache._orable[i];if(e)return this._offset=e[1],e[0];var _=this._offset,h=new Array(2),r=S,n=null;if(this._offset<this._inputSize&&(n=this._input.substring(this._offset,this._offset+0)),""===n?(r=new f(this._input.substring(this._offset,this._offset+0),this._offset),this._offset=this._offset+0):(r=S,this._offset>this._failure&&(this._failure=this._offset,this._expected=[]),this._offset===this._failure&&this._expected.push('""')),r!==S){h[0]=r;var o;(o=this._read_base())!==S?h[1]=o:(h=null,this._offset=_)}else h=null,this._offset=_;return null===h?t=S:(t=new a(this._input.substring(_,this._offset),_,h),this._offset=this._offset),s(t,this._types.Including),this._cache._orable[i]=[t,this._offset],t},_read_base:function(){var t=S,s=this._offset;this._cache._base=this._cache._base||{};var i=this._cache._base[s];if(i)return this._offset=i[1],i[0];var e=this._offset;return(t=this._read_group())===S&&(this._offset=e,(t=this._read_list())===S&&(this._offset=e,(t=this._read_pair())===S&&(this._offset=e,(t=this._read_exact())===S&&(this._offset=e,(t=this._read_hashtag())===S&&(this._offset=e,(t=this._read_mention())===S&&(this._offset=e,(t=this._read_word())===S&&(this._offset=e))))))),this._cache._base[s]=[t,this._offset],t},_read_group:function(){var t=S,i=this._offset;this._cache._group=this._cache._group||{};var e=this._cache._group[i];if(e)return this._offset=e[1],e[0];var _=this._offset,h=new Array(3),r=S,n=null;if(this._offset<this._inputSize&&(n=this._input.substring(this._offset,this._offset+1)),"("===n?(r=new f(this._input.substring(this._offset,this._offset+1),this._offset),this._offset=this._offset+1):(r=S,this._offset>this._failure&&(this._failure=this._offset,this._expected=[]),this._offset===this._failure&&this._expected.push('"("')),r!==S){h[0]=r;var o;if((o=this._read_root())!==S){h[1]=o;var u=S,a=null;this._offset<this._inputSize&&(a=this._input.substring(this._offset,this._offset+1)),")"===a?(u=new f(this._input.substring(this._offset,this._offset+1),this._offset),this._offset=this._offset+1):(u=S,this._offset>this._failure&&(this._failure=this._offset,this._expected=[]),this._offset===this._failure&&this._expected.push('")"')),u!==S?h[2]=u:(h=null,this._offset=_)}else h=null,this._offset=_}else h=null,this._offset=_;return null===h?t=S:(t=new l(this._input.substring(_,this._offset),_,h),this._offset=this._offset),s(t,this._types.Group),this._cache._group[i]=[t,this._offset],t},_read_pair:function(){var t=S,i=this._offset;this._cache._pair=this._cache._pair||{};var e=this._cache._pair[i];if(e)return this._offset=e[1],e[0];var f,_=this._offset,h=new Array(3);if((f=this._read_slug())!==S){h[0]=f;var r;if((r=this._read_sep())!==S){h[1]=r;var n;(n=this._read_word())!==S?h[2]=n:(h=null,this._offset=_)}else h=null,this._offset=_}else h=null,this._offset=_;return null===h?t=S:(t=new c(this._input.substring(_,this._offset),_,h),this._offset=this._offset),s(t,this._types.Pair),this._cache._pair[i]=[t,this._offset],t},_read_list:function(){var t=S,i=this._offset;this._cache._list=this._cache._list||{};var e=this._cache._list[i];if(e)return this._offset=e[1],e[0];var _=this._offset,h=new Array(3),r=S,n=null;if(this._offset<this._inputSize&&(n=this._input.substring(this._offset,this._offset+4)),"list"===n?(r=new f(this._input.substring(this._offset,this._offset+4),this._offset),this._offset=this._offset+4):(r=S,this._offset>this._failure&&(this._failure=this._offset,this._expected=[]),this._offset===this._failure&&this._expected.push('"list"')),r!==S){h[0]=r;var o;if((o=this._read_sep())!==S){h[1]=o;var u;(u=this._read_list_name())!==S?h[2]=u:(h=null,this._offset=_)}else h=null,this._offset=_}else h=null,this._offset=_;return null===h?t=S:(t=new p(this._input.substring(_,this._offset),_,h),this._offset=this._offset),s(t,this._types.List),this._cache._list[i]=[t,this._offset],t},_read_exact:function(){var t=S,i=this._offset;this._cache._exact=this._cache._exact||{};var e=this._cache._exact[i];if(e)return this._offset=e[1],e[0];var _=this._offset,h=new Array(3),r=S,n=null;if(this._offset<this._inputSize&&(n=this._input.substring(this._offset,this._offset+1)),'"'===n?(r=new f(this._input.substring(this._offset,this._offset+1),this._offset),this._offset=this._offset+1):(r=S,this._offset>this._failure&&(this._failure=this._offset,this._expected=[]),this._offset===this._failure&&this._expected.push("'\"'")),r!==S){h[0]=r;for(var o=S,u=0,a=this._offset,l=[],c=!0;c!==S;){var p=null;this._offset<this._inputSize&&(p=this._input.substring(this._offset,this._offset+1)),null!==p&&/^[^\"]/.test(p)?(c=new f(this._input.substring(this._offset,this._offset+1),this._offset),this._offset=this._offset+1):(c=S,this._offset>this._failure&&(this._failure=this._offset,this._expected=[]),this._offset===this._failure&&this._expected.push('[^\\"]')),c!==S&&(l.push(c),--u)}if(u<=0?(o=new f(this._input.substring(a,this._offset),a,l),this._offset=this._offset):o=S,o!==S){h[1]=o;var g=S,v=null;this._offset<this._inputSize&&(v=this._input.substring(this._offset,this._offset+1)),'"'===v?(g=new f(this._input.substring(this._offset,this._offset+1),this._offset),this._offset=this._offset+1):(g=S,this._offset>this._failure&&(this._failure=this._offset,this._expected=[]),this._offset===this._failure&&this._expected.push("'\"'")),g!==S?h[2]=g:(h=null,this._offset=_)}else h=null,this._offset=_}else h=null,this._offset=_;return null===h?t=S:(t=new d(this._input.substring(_,this._offset),_,h),this._offset=this._offset),s(t,this._types.Exactly),this._cache._exact[i]=[t,this._offset],t},_read_hashtag:function(){var t=S,i=this._offset;this._cache._hashtag=this._cache._hashtag||{};var e=this._cache._hashtag[i];if(e)return this._offset=e[1],e[0];var _=this._offset,h=new Array(2),r=S,n=null;if(this._offset<this._inputSize&&(n=this._input.substring(this._offset,this._offset+1)),"#"===n?(r=new f(this._input.substring(this._offset,this._offset+1),this._offset),this._offset=this._offset+1):(r=S,this._offset>this._failure&&(this._failure=this._offset,this._expected=[]),this._offset===this._failure&&this._expected.push('"#"')),r!==S){h[0]=r;var o;(o=this._read_tag())!==S?h[1]=o:(h=null,this._offset=_)}else h=null,this._offset=_;return null===h?t=S:(t=new g(this._input.substring(_,this._offset),_,h),this._offset=this._offset),s(t,this._types.Text),this._cache._hashtag[i]=[t,this._offset],t},_read_cashtag:function(){var t=S,i=this._offset;this._cache._cashtag=this._cache._cashtag||{};var e=this._cache._cashtag[i];if(e)return this._offset=e[1],e[0];var _=this._offset,h=new Array(2),r=S,n=null;if(this._offset<this._inputSize&&(n=this._input.substring(this._offset,this._offset+1)),"$"===n?(r=new f(this._input.substring(this._offset,this._offset+1),this._offset),this._offset=this._offset+1):(r=S,this._offset>this._failure&&(this._failure=this._offset,this._expected=[]),this._offset===this._failure&&this._expected.push('"$"')),r!==S){h[0]=r;var o;(o=this._read_tag())!==S?h[1]=o:(h=null,this._offset=_)}else h=null,this._offset=_;return null===h?t=S:(t=new v(this._input.substring(_,this._offset),_,h),this._offset=this._offset),s(t,this._types.Text),this._cache._cashtag[i]=[t,this._offset],t},_read_mention:function(){var t=S,i=this._offset;this._cache._mention=this._cache._mention||{};var e=this._cache._mention[i];if(e)return this._offset=e[1],e[0];var _=this._offset,h=new Array(2),r=S,n=null;if(this._offset<this._inputSize&&(n=this._input.substring(this._offset,this._offset+0)),""===n?(r=new f(this._input.substring(this._offset,this._offset+0),this._offset),this._offset=this._offset+0):(r=S,this._offset>this._failure&&(this._failure=this._offset,this._expected=[]),this._offset===this._failure&&this._expected.push('""')),r!==S){h[0]=r;var o;(o=this._read_screen_name())!==S?h[1]=o:(h=null,this._offset=_)}else h=null,this._offset=_;return null===h?t=S:(t=new y(this._input.substring(_,this._offset),_,h),this._offset=this._offset),s(t,this._types.Text),this._cache._mention[i]=[t,this._offset],t},_read_word:function(){var t=S,i=this._offset;this._cache._word=this._cache._word||{};var e=this._cache._word[i];if(e)return this._offset=e[1],e[0];var _=this._offset,h=new Array(2),r=S,n=this._offset,o=null;if(this._offset<this._inputSize&&(o=this._input.substring(this._offset,this._offset+1)),"+"===o?(r=new f(this._input.substring(this._offset,this._offset+1),this._offset),this._offset=this._offset+1):(r=S,this._offset>this._failure&&(this._failure=this._offset,this._expected=[]),this._offset===this._failure&&this._expected.push('"+"')),r===S&&(r=new f(this._input.substring(n,n),n),this._offset=n),r!==S){h[0]=r;for(var u=S,a=1,l=this._offset,c=[],p=!0;p!==S;){var d=null;this._offset<this._inputSize&&(d=this._input.substring(this._offset,this._offset+1)),null!==d&&/^[^\s\)\(]/.test(d)?(p=new f(this._input.substring(this._offset,this._offset+1),this._offset),this._offset=this._offset+1):(p=S,this._offset>this._failure&&(this._failure=this._offset,this._expected=[]),this._offset===this._failure&&this._expected.push("[^\\s\\)\\(]")),p!==S&&(c.push(p),--a)}a<=0?(u=new f(this._input.substring(l,this._offset),l,c),this._offset=this._offset):u=S,u!==S?h[1]=u:(h=null,this._offset=_)}else h=null,this._offset=_;return null===h?t=S:(t=new f(this._input.substring(_,this._offset),_,h),this._offset=this._offset),s(t,this._types.Text),this._cache._word[i]=[t,this._offset],t},_read_or_sep:function(){var t=S,s=this._offset;this._cache._or_sep=this._cache._or_sep||{};var i=this._cache._or_sep[s];if(i)return this._offset=i[1],i[0];for(var e=this._offset,_=new Array(3),h=S,r=1,n=this._offset,o=[],u=!0;u!==S;)(u=this._read___())!==S&&(o.push(u),--r);if(r<=0?(h=new f(this._input.substring(n,this._offset),n,o),this._offset=this._offset):h=S,h!==S){_[0]=h;var a=S,l=null;if(this._offset<this._inputSize&&(l=this._input.substring(this._offset,this._offset+2)),"OR"===l?(a=new f(this._input.substring(this._offset,this._offset+2),this._offset),this._offset=this._offset+2):(a=S,this._offset>this._failure&&(this._failure=this._offset,this._expected=[]),this._offset===this._failure&&this._expected.push('"OR"')),a!==S){_[1]=a;for(var c=S,p=1,d=this._offset,g=[],v=!0;v!==S;)(v=this._read___())!==S&&(g.push(v),--p);p<=0?(c=new f(this._input.substring(d,this._offset),d,g),this._offset=this._offset):c=S,c!==S?_[2]=c:(_=null,this._offset=e)}else _=null,this._offset=e}else _=null,this._offset=e;return null===_?t=S:(t=new f(this._input.substring(e,this._offset),e,_),this._offset=this._offset),this._cache._or_sep[s]=[t,this._offset],t},_read_list_name:function(){var t=S,s=this._offset;this._cache._list_name=this._cache._list_name||{};var i=this._cache._list_name[s];if(i)return this._offset=i[1],i[0];var e,_=this._offset,h=new Array(3);if((e=this._read_screen_name())!==S){h[0]=e;var r=S,n=null;if(this._offset<this._inputSize&&(n=this._input.substring(this._offset,this._offset+1)),"/"===n?(r=new f(this._input.substring(this._offset,this._offset+1),this._offset),this._offset=this._offset+1):(r=S,this._offset>this._failure&&(this._failure=this._offset,this._expected=[]),this._offset===this._failure&&this._expected.push('"/"')),r!==S){h[1]=r;var o;(o=this._read_list_slug())!==S?h[2]=o:(h=null,this._offset=_)}else h=null,this._offset=_}else h=null,this._offset=_;return null===h?t=S:(t=new b(this._input.substring(_,this._offset),_,h),this._offset=this._offset),this._cache._list_name[s]=[t,this._offset],t},_read_list_slug:function(){var t=S,s=this._offset;this._cache._list_slug=this._cache._list_slug||{};var i=this._cache._list_slug[s];if(i)return this._offset=i[1],i[0];for(var e=1,_=this._offset,h=[],r=!0;r!==S;){var n=null;this._offset<this._inputSize&&(n=this._input.substring(this._offset,this._offset+1)),null!==n&&/^[a-z-]/.test(n)?(r=new f(this._input.substring(this._offset,this._offset+1),this._offset),this._offset=this._offset+1):(r=S,this._offset>this._failure&&(this._failure=this._offset,this._expected=[]),this._offset===this._failure&&this._expected.push("[a-z-]")),r!==S&&(h.push(r),--e)}return e<=0?(t=new f(this._input.substring(_,this._offset),_,h),this._offset=this._offset):t=S,this._cache._list_slug[s]=[t,this._offset],t},_read_screen_name:function(){var t=S,s=this._offset;this._cache._screen_name=this._cache._screen_name||{};var i=this._cache._screen_name[s];if(i)return this._offset=i[1],i[0];var e=this._offset,_=new Array(2),h=S,r=this._offset,n=null;if(this._offset<this._inputSize&&(n=this._input.substring(this._offset,this._offset+1)),"@"===n?(h=new f(this._input.substring(this._offset,this._offset+1),this._offset),this._offset=this._offset+1):(h=S,this._offset>this._failure&&(this._failure=this._offset,this._expected=[]),this._offset===this._failure&&this._expected.push('"@"')),h===S&&(h=new f(this._input.substring(r,r),r),this._offset=r),h!==S){_[0]=h;var o;(o=this._read_slug())!==S?_[1]=o:(_=null,this._offset=e)}else _=null,this._offset=e;return null===_?t=S:(t=new w(this._input.substring(e,this._offset),e,_),this._offset=this._offset),this._cache._screen_name[s]=[t,this._offset],t},_read_date:function(){var t=S,s=this._offset;this._cache._date=this._cache._date||{};var i=this._cache._date[s];if(i)return this._offset=i[1],i[0];var e,_=this._offset,h=new Array(10);if((e=this._read_d())!==S){h[0]=e;var r;if((r=this._read_d())!==S){h[1]=r;var n;if((n=this._read_d())!==S){h[2]=n;var o;if((o=this._read_d())!==S){h[3]=o;var u=S,a=null;if(this._offset<this._inputSize&&(a=this._input.substring(this._offset,this._offset+1)),"-"===a?(u=new f(this._input.substring(this._offset,this._offset+1),this._offset),this._offset=this._offset+1):(u=S,this._offset>this._failure&&(this._failure=this._offset,this._expected=[]),this._offset===this._failure&&this._expected.push('"-"')),u!==S){h[4]=u;var l;if((l=this._read_d())!==S){h[5]=l;var c;if((c=this._read_d())!==S){h[6]=c;var p=S,d=null;if(this._offset<this._inputSize&&(d=this._input.substring(this._offset,this._offset+1)),"-"===d?(p=new f(this._input.substring(this._offset,this._offset+1),this._offset),this._offset=this._offset+1):(p=S,this._offset>this._failure&&(this._failure=this._offset,this._expected=[]),this._offset===this._failure&&this._expected.push('"-"')),p!==S){h[7]=p;var g;if((g=this._read_d())!==S){h[8]=g;var v;(v=this._read_d())!==S?h[9]=v:(h=null,this._offset=_)}else h=null,this._offset=_}else h=null,this._offset=_}else h=null,this._offset=_}else h=null,this._offset=_}else h=null,this._offset=_}else h=null,this._offset=_}else h=null,this._offset=_}else h=null,this._offset=_}else h=null,this._offset=_;return null===h?t=S:(t=new x(this._input.substring(_,this._offset),_,h),this._offset=this._offset),this._cache._date[s]=[t,this._offset],t},_read_tag:function(){var t,s=this._offset;this._cache._tag=this._cache._tag||{};var i=this._cache._tag[s];return i?(this._offset=i[1],i[0]):(t=this._read_slug(),this._cache._tag[s]=[t,this._offset],t)},_read_slug:function(){var t=S,s=this._offset;this._cache._slug=this._cache._slug||{};var i=this._cache._slug[s];if(i)return this._offset=i[1],i[0];for(var e=1,_=this._offset,h=[],r=!0;r!==S;){var n=null;this._offset<this._inputSize&&(n=this._input.substring(this._offset,this._offset+1)),null!==n&&/^[a-zA-Z0-9_]/.test(n)?(r=new f(this._input.substring(this._offset,this._offset+1),this._offset),this._offset=this._offset+1):(r=S,this._offset>this._failure&&(this._failure=this._offset,this._expected=[]),this._offset===this._failure&&this._expected.push("[a-zA-Z0-9_]")),r!==S&&(h.push(r),--e)}return e<=0?(t=new f(this._input.substring(_,this._offset),_,h),this._offset=this._offset):t=S,this._cache._slug[s]=[t,this._offset],t},_read_sep:function(){var t=S,s=this._offset;this._cache._sep=this._cache._sep||{};var i=this._cache._sep[s];if(i)return this._offset=i[1],i[0];var e=null;return this._offset<this._inputSize&&(e=this._input.substring(this._offset,this._offset+1)),":"===e?(t=new f(this._input.substring(this._offset,this._offset+1),this._offset),this._offset=this._offset+1):(t=S,this._offset>this._failure&&(this._failure=this._offset,this._expected=[]),this._offset===this._failure&&this._expected.push('":"')),this._cache._sep[s]=[t,this._offset],t},_read_integer:function(){var t=S,s=this._offset;this._cache._integer=this._cache._integer||{};var i=this._cache._integer[s];if(i)return this._offset=i[1],i[0];var e,_=this._offset,h=new Array(2);if((e=this._read_d())!==S){h[0]=e;for(var r=S,n=0,o=this._offset,u=[],a=!0;a!==S;)(a=this._read_d())!==S&&(u.push(a),--n);n<=0?(r=new f(this._input.substring(o,this._offset),o,u),this._offset=this._offset):r=S,r!==S?h[1]=r:(h=null,this._offset=_)}else h=null,this._offset=_;return null===h?t=S:(t=new m(this._input.substring(_,this._offset),_,h),this._offset=this._offset),this._cache._integer[s]=[t,this._offset],t},_read_d:function(){var t=S,s=this._offset;this._cache._d=this._cache._d||{};var i=this._cache._d[s];if(i)return this._offset=i[1],i[0];var e=null;return this._offset<this._inputSize&&(e=this._input.substring(this._offset,this._offset+1)),null!==e&&/^[0-9]/.test(e)?(t=new f(this._input.substring(this._offset,this._offset+1),this._offset),this._offset=this._offset+1):(t=S,this._offset>this._failure&&(this._failure=this._offset,this._expected=[]),this._offset===this._failure&&this._expected.push("[0-9]")),this._cache._d[s]=[t,this._offset],t},_read___:function(){var t=S,s=this._offset;this._cache.___=this._cache.___||{};var i=this._cache.___[s];if(i)return this._offset=i[1],i[0];var e=null;return this._offset<this._inputSize&&(e=this._input.substring(this._offset,this._offset+1)),null!==e&&/^[\s]/.test(e)?(t=new f(this._input.substring(this._offset,this._offset+1),this._offset),this._offset=this._offset+1):(t=S,this._offset>this._failure&&(this._failure=this._offset,this._expected=[]),this._offset===this._failure&&this._expected.push("[\\s]")),this._cache.___[s]=[t,this._offset],t}},A=function(t,s,i){this._input=t,this._inputSize=t.length,this._actions=s,this._types=i,this._offset=0,this._cache={},this._failure=0,this._expected=[]};A.prototype.parse=function(){var t=this._read_root();if(t!==S&&this._offset===this._inputSize)return t;throw 0===this._expected.length&&(this._failure=this._offset,this._expected.push("<EOF>")),this.constructor.lastError={offset:this._offset,expected:this._expected},new SyntaxError(function(t,s,i){for(var e=t.split(/\n/g),f=0,_=0;_<=s;)_+=e[f].length+1,f+=1;var h="Line "+f+": expected "+i.join(", ")+"\n",r=e[f-1];for(h+=r+"\n",_-=r.length+1;_<s;)h+=" ",_+=1;return h+"^"}(this._input,this._failure,this._expected))};s(A.prototype,z);var V={Grammar:z,Parser:A,parse:function(t,s){return new A(t,(s=s||{}).actions,s.types).parse()}};"function"==typeof t&&"object"==typeof i?s(i,V):(void 0!==this?this:window).Query=V}()},{}]},{},[1])(1)});